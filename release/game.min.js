var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v,m=t&&t.split("/"),g=u.map,y=g&&g["*"]||{};if(e){e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e[0].charAt(0)==="."&&m&&(v=m.slice(0,m.length-1),e=v.concat(e));for(h=0;h<e.length;h++){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===0||h===1&&e[2]===".."||e[h-1]==="..")continue;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}if((m||y)&&g){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(m)for(p=m.length;p>0;p-=1){i=g[m.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&y&&y[r]&&(f=y[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../lib/almond",function(){}),define("defines",[],function(){"use strict";var e;return e={debugging:!1,developing:!1,domStateEvents:!0,gameW:416,gameH:600,artH:2912,mapH:3136,buttonW:80,buttonH:30,deadzoneH:100,shakeFallH:300,fontLarge:32,fontSmall:16,playerH:72,playerW:72,playerYOffset:16,progressW:360,progressH:8}});var hasProp={}.hasOwnProperty,slice=[].slice;define("helpers",[],function(){"use strict";var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;return i=Phaser.Easing,s=Phaser.Point,a=Phaser.RenderTexture,f=Phaser.Sprite,h=Phaser.Timer,u={PrettyHashRemove:/[{}"]/g,PrettyHashPad:/[:,]/g},e={playAnimation:function(e,t){var n,r,i,s;t==null&&(t=!0);if(t===!1&&((i=this.animation)!=null?i.isPlaying:void 0))return!1;if(_.isNumber(e))n=e,this.animations.frame=n,this.animation=null;else{r=e;if(((s=this.animation)!=null?s.name:void 0)===r)return!1;this.animation=this.animations.play(r)}return typeof this.debug=="function"&&this.debug("animation",e),this.animation},fadeTo:function(e,t,n,r){var i;return r==null&&(r=!0),r&&(e.alpha=n===0?1:0),i=this.add.tween(e).to({alpha:n},t,"Cubic",!0)}},t={updatePositionWithCursors:function(e,t){t==null&&(t=4),e.up.isDown?this.y-=t:e.down.isDown?this.y+=t:e.left.isDown?this.x-=t:e.right.isDown&&(this.x+=t)}},r={_initDebugMixin:function(e){var t;return this.debugging==null&&(this.debugging=!0),this.tracing==null&&(this.tracing=!1),this.debugTextItems={},e==null?!1:(this.gui=e,t=this.gui.add(this,"debugging"),t.listen(),t.onFinishChange(function(e){return function(){return e.debugTextItems={}}}(this)),this.gui.add(this,"tracing"),!0)},debug:function(e,t,n){if(!this.debugging)return;_.isNumber(t)&&(t=parseFloat(t.toFixed(2))),t instanceof s&&(t=this._prettyHash(this._prettyPoint(t))),(n!=null?n.position:void 0)&&n.position instanceof s&&(n.position=this._prettyPoint(n.position)),this.tracing?(e=this.debugNamespace+":"+e,n!=null?console.trace(e,t,n):console.trace(e,t)):_.isArray(t)&&(_.isArray(t[0])||_.isPlainObject(t[0]))?(e=this.debugNamespace+":"+e,console.groupCollapsed(e),typeof console.table=="function"&&console.table(t),console.groupEnd()):(n=n!=null?this._prettyHash(n):"",this.debugTextItems[e]=(e+": "+t+" "+n).trim())},_prettyPoint:function(e){return _.chain(e).pick("x","y").mapObject(function(e){return parseFloat(e.toFixed(2))}).value()},_prettyHash:function(e){return JSON.stringify(e).replace(u.PrettyHashRemove,"").replace(u.PrettyHashPad,"$& ")}},g=-8,y=1.8,n={_initDebugDisplayMixin:function(e){this.debugFontSize==null&&(this.debugFontSize=9),this._debugGutter=2*this.debugFontSize,this._debugLine=y*this.debugFontSize,this.debugDisplay=e.debug,this.debugDisplay.font=this.debugFontSize+"px Menlo"},resetDebugDisplayLayout:function(){this._layoutX=this._debugGutter+g,this._layoutY=this._debugGutter},renderDebugDisplayItems:function(e,t){var n,r;if(_.isFunction(e)&&t!=null)e(this._layoutX,this._layoutY),this._layoutY+=t*this._debugLine;else for(n in e){if(!hasProp.call(e,n))continue;r=e[n],this.debugDisplay.text(r,this._layoutX,this._layoutY,null,this.debugDisplay.font),this._layoutY+=this._debugLine}}},p=function(){var e;return e=this.addFolder.apply(this,arguments),e.open(),e},d=function(e,t,n){var r,i,s,o,u;return n==null&&(n=!0),u=e[t],o=[u/2,2*u],s=o[0],i=o[1],u<0?r=this.add(e,t,i,s):u>0?r=this.add(e,t,s,i):r=this.add(e,t),n?this:r},_.extend(dat.GUI.prototype,{addOpenFolder:p,addRange:d}),v=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;l=function(){var t,n,r;r=[];for(t=0,n=e.length;t<n;t++)h=e[t],r.push(_.clone(h));return r}();for(f=i=0,u=l.length;i<u;f=++i){h=l[f];for(n=s=0,a=h.length;s<a;n=++s){r=h[n];if(r!==1)continue;o=c=d=t=1,n!==0&&(o=e[f][n-1]),n!==h.length-1&&(c=e[f][n+1]),f!==0&&(d=e[f-1][n]),f!==e.length-1&&(t=e[f+1][n]);switch([d,c,t,o].join()){case"0,0,0,0":p=1;break;case"1,0,0,0":p=2;break;case"0,1,0,0":p=3;break;case"1,1,0,0":p=4;break;case"0,0,1,0":p=5;break;case"1,0,1,0":p=6;break;case"0,1,1,0":p=7;break;case"1,1,1,0":p=8;break;case"0,0,0,1":p=9;break;case"1,0,0,1":p=10;break;case"0,1,0,1":p=11;break;case"1,1,0,1":p=12;break;case"0,0,1,1":p=13;break;case"1,0,1,1":p=14;break;case"0,1,1,1":p=15;break;case"1,1,1,1":p=16}h[n]=p}}return l},o={addPoint:function(e){return this.add(e.x,e.y)},dividePoint:function(e){return this.divide(e.x,e.y)},multiplyPoint:function(e){return this.multiply(e.x,e.y)},subtractPoint:function(e){return this.subtract(e.x,e.y)}},l={startWithTransition:function(){var e,t,n,r,s,o,u,l,c,p,d,v,m;m=arguments[0],c=2<=arguments.length?slice.call(arguments,1):[],m==null&&(m={}),l=_.defaults(m,{duration:2*h.SECOND,easing:i.Exponential.InOut,properties:{alpha:0}}),n=l.duration,r=l.easing,u=l.properties,d=c[0],p=this.states[d],s=p.init,e=p.create,this.game.camera.unfollow(),this.game.paused=!0,v=new a(this.game,this.game.width,this.game.height,"transition-to-"+d),v.renderXY(this.game.world,-this.game.camera.x,-this.game.camera.y),this.game.paused=!1,o=new f(this.game,0,0,v),o.fixedToCamera=!0,t=function(){if(v==null||o==null)return;v.destroy(),o.destroy(),v=o=null,p.init=s,p.create=e},p.init=function(e){return function(){s!=null&&s.apply(p,arguments),e.game.add.existing(o)}}(this),p.create=function(i){return function(){e!=null&&e.apply(p,arguments),o.bringToTop(),i.game.add.tween(o).to(u,n,r,!0).onComplete.addOnce(t)}}(this),_.delay(t,2*n),this.start.apply(this,c)}},c={addCenteredText:function(e,t,n,r){return _.defaults(n,{boundsAlignH:"center",boundsAlignV:"middle"}),e=this.add.text(this.world.centerX,t.y,e,n,r),e.anchor.setTo(.5),t.y+=e.height+t.baseline,e}},m=function(e){return _.isObject(e)&&!_.isFunction(e)},_.mixin({isPlainObject:m}),{AnimationMixin:e,CameraMixin:t,DebugMixin:r,DebugDisplayMixin:n,PointMixin:o,RegExps:u,StateManagerMixin:l,TextMixin:c,autoSetTiles:v}}),define("site",["defines"],function(e){"use strict";var t,n,r,i,s;return n=Modernizr.classlist,r=Modernizr.csstransitions,i=Modernizr.history,s=Modernizr.prefixedCSS,t={},t.initFiddle=function(t){var n,r;if(!i)return;return window.history.replaceState({fiddle:!1},document.title),n=document.querySelector("#fiddle"),n.addEventListener("click",function(){e.developing=!0,window.history.pushState({fiddle:!0},document.title+" (fiddling)","fiddle"),n.setAttribute("disabled","")}),window.addEventListener("popstate",function(t){_game.state.current==="play"?window.location.reload():t.state.fiddle===!1&&(e.developing=!1,n.removeAttribute("disabled"))}),r=document.querySelector("#morning-stroll"),r.addEventListener("state:play",function(){n.setAttribute("disabled","")}),r.addEventListener("state:menu",function(){n.removeAttribute("disabled"),window.history.state.fiddle===!0&&window.history.back()})},t.initAbout=function(){var e,t,i,o;if(!n||!r)return;i=window.getComputedStyle(document.querySelector("#framed")),e=(parseFloat(i[s("transition-duration")])+parseFloat(i[s("transition-delay")]))*1e3,t=document.querySelector("#frame"),o=document.querySelector("#toggle-about"),o.addEventListener("click",function(){t.classList.toggle("flipped"),t.classList.add("flipping"),o.setAttribute("disabled",""),setTimeout(function(){t.classList.remove("flipping"),o.removeAttribute("disabled")},e)})},t});var extend=function(e,t){function r(){this.constructor=e}for(var n in t)hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("state-boot",[],function(){"use strict";var e;return e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.init=function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0},t.prototype.preload=function(){this.load.image("progress-bar-bg","assets/progress-bar-bg.png"),this.load.image("progress-bar-fg","assets/progress-bar-fg.png")},t.prototype.create=function(){this.state.start("preload")},t}(Phaser.State),e});var extend=function(e,t){function r(){this.constructor=e}for(var n in t)hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("state-menu",["defines","helpers"],function(e,t){"use strict";var n,r,i,s,o,u;return r=Phaser.State,s=e.domStateEvents,o=e.fontLarge,u=e.fontSmall,i=t.TextMixin,n=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,t),n.prototype.init=function(){var e;s&&(e=document.createEvent("CustomEvent"),e.initCustomEvent("state:menu",!1,!1,void 0),this.game.parent.dispatchEvent(e))},n.prototype.create=function(){var t,n;this.add.image(0,0,"bg-start"),this.layout={y:this.game.height/4,baseline:40},this._addText("Morning Stroll",{fontSize:o}),this._addText("Climb and see!",{fontSize:u}),this.layout.y+=2*this.layout.baseline,t=(this.game.width-e.buttonW)/2,n=this.layout.y-e.buttonH/2,this.add.button(t,n,"button",this.play,this,1,0,2),this._addText("start",{fontSize:u})},n.prototype.update=function(){},n.prototype.play=function(){this.state.startWithTransition(null,"play")},n.prototype._addText=function(e,t){return _.defaults(t,{fill:"#fff",font:"Enriqueta"}),e=this.addCenteredText(e,this.layout,t)},n}(r),_.extend(n.prototype,i),n});var bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function r(){this.constructor=e}for(var n in t)hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("state-preload",["defines"],function(e){"use strict";var t,n,r,i,s,o,u,a,f,l;return n=Phaser.State,r=Phaser.Timer,o=e.developing,i=e.buttonH,s=e.buttonW,u=e.playerH,a=e.playerW,f=e.progressH,l=e.progressW,t=function(e){function t(){return this._onWebFontLoadComplete=bind(this._onWebFontLoadComplete,this),this.menu=bind(this.menu,this),this.update=bind(this.update,this),t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.init=function(){this.menu=_.after(2,this.menu).bind(this),window.WebFontConfig={active:this._onWebFontLoadComplete,inactive:this._onWebFontLoadComplete,google:{families:["Enriqueta:400:latin"]}}},t.prototype.preload=function(){var e,t,n,r,o,c;r=this.world.centerX-l/2,o=this.world.centerY-f/2,this.progressTrack=this.add.sprite(r,o,"progress-bar-bg"),this.progressThumb=this.add.sprite(r,o,"progress-bar-fg"),this.load.setPreloadSprite(this.progressThumb),n="//ajax.googleapis.com/ajax/libs/webfont/1.5/webfont.js",this.load.script("webfont",n),this.load.audio("bgm",["assets/morning-stroll.mp3"],!0),this.load.spritesheet("button","assets/button.png",s,i),this.load.image("bg-start","assets/bg-start.jpg"),this.load.image("balcony","assets/tiles-auto-balcony.png");for(c=e=16;e>=1;c=--e)t=(16-c+1e4).toString().substr(1),this.load.image("bg"+c,"assets/bg-_"+t+"_"+c+".png");this.load.spritesheet("mate","assets/mate.png",a,u),this.load.spritesheet("player","assets/player.png",a,u)},t.prototype.create=function(){this.progressThumb.cropEnabled=!1},t.prototype.update=function(){this._onceMenu==null&&(this._onceMenu=_.once(this.menu)),this.cache.isSoundDecoded("bgm")?this._onceMenu():this.time.events.add(r.HALF,this.update)},t.prototype.menu=function(){var e;e=o?"play":"menu",this.state.start(e)},t.prototype._onWebFontLoadComplete=function(){this.time.events.add(r.SECOND,this.menu)},t}(n),t}),define("background",["defines","helpers"],function(e,t){"use strict";var n,r;return r=t.DebugMixin,n=function(){function t(e,t){e==null&&(e={}),this.layers=[],_.defaults(e,{parallaxFactor:.95,parallaxBuffer:1.7,layoutMode:"full"}),this.layoutMode=e.layoutMode,this.parallaxBuffer=e.parallaxBuffer,this.parallaxFactor=e.parallaxFactor,this.parallaxTolerance=e.parallaxTolerance,this._topZIndex=1,this._initialize(t)}return t.prototype._initialize=function(e){this.add=e.add,this.camera=e.camera,this.group=this.add.group(),this.group.visible=!1,this._initDebugging()},t.prototype._initDebugging=function(){this.debugNamespace="background",this.debugging=e.debugging,this._initDebugMixin()},t.prototype.destroy=function(){},t.prototype.addImages=function(e,t,n){var r,i,s,o,u,a;n==null&&(n=1),this._topZIndex=t;for(a=r=o=n,u=t;o<=u?r<=u:r>=u;a=o<=u?++r:--r)s=e({zIndex:a}),i=this.add.image(0,0,s,this.group),i.autoCull=!0,this.layers.push({image:i,zIndex:a})},t.prototype.layout=function(){var e,t,n,r,i,s,o;s=this.layers;for(t=0,i=s.length;t<i;t++)r=s[t],n=r.image,o=r.zIndex,e=Math.pow(o/this.layers.length,2)*this.parallaxFactor,e=(e+this.parallaxBuffer/2)/this.parallaxBuffer,r.scrollFactor=Math.min(1,e),r.scrollResistance=Math.max(0,1-e);this.debug("layers",this.layers)},t.prototype.update=function(){var e,t,n,r,i,s,o,u;r=this.layers;for(e=0,n=r.length;e<n;e++)i=r[e],t=i.image,u=i.zIndex,s=i.scrollFactor,o=i.scrollResistance,t.y=this.camera.y*o,u!==1&&(t.y+=this.parallaxTolerance,u!==this._topZIndex&&(t.y-=this.parallaxTolerance*Math.pow(s,1/3)))},t}(),_.extend(n.prototype,r),n}),define("in-state-menu",["defines","helpers"],function(e,t){"use strict";var n,r,i,s,o;return i=Phaser.Keyboard,o=e.fontSmall,n=t.DebugMixin,s=t.TextMixin,r=function(){function e(e,t,n){var r;this.textItems=e,n==null&&(n={}),r=_.defaults(n,{baseTextStyle:{fill:"#fff",font:"Enriqueta"},layout:{y:120,baseline:40},pauseHandler:function(e){return t.paused=e},toggleKeyCode:i.P}),this.baseTextStyle=r.baseTextStyle,this.pauseHandler=r.pauseHandler,this.layout=r.layout,this.toggleKeyCode=r.toggleKeyCode,this.add=t.add,this.height=t.height,this.input=t.input,this.width=t.width,this.world=t.world,this._initialize()}return e.prototype._initialize=function(){var e,t,n,r,i,s;this.group=this.add.group(null,"in-state-menu",!0),this.overlay=this.add.graphics(0,0,this.group),this.overlay.beginFill(0,.8),this.overlay.drawRect(0,0,this.width,this.height),this.overlay.endFill(),n=this.textItems;for(e=0,t=n.length;e<t;e++)r=n[e],s=r[0],i=r[1],this._addText(s,i);this._addText("Press P again to continue",{fontSize:o}),this.toggleKey=this.input.keyboard.addKey(this.toggleKeyCode),this.toggleKey.onDown.add(this.toggle,this),this.input.keyboard.removeKeyCapture(this.toggleKeyCode),this.toggle(!1),this._initDebugging()},e.prototype._initDebugging=function(){var e;this.debugNamespace="in-state-menu",this.tracing=!0,e=this._initDebugMixin()},e.prototype.destroy=function(){this.group.destroy(),this.toggleKey.onDown.removeAll(this)},e.prototype.toggle=function(e){_.isBoolean(e)||(e=!this.group.visible),this.group.visible=e,this.pauseHandler(e)},e.prototype._addText=function(e,t){return _.defaults(t,this.baseTextStyle),this.addCenteredText(e,this.layout,t,this.group)},e}(),_.extend(r.prototype,n,s),r}),define("platforms",["defines","helpers"],function(e,t){"use strict";var n,r,i,s,o,u;return s=Phaser.Point,u=t.autoSetTiles,n=t.DebugMixin,o={Empty:0,Solid:1,Meta:2},i=function(){function t(e,t,n){this.config=e,this.minLedgeSize=3,this.maxLedgeSize=5,this.minLedgeSpacing=new s(4,2),this.maxLedgeSpacing=new s(8,4),this.ledgeThickness=2,this.tileWidth=this.tileHeight=32,this.ledges=[],this.tiles=[],this._initialize(t,n)}return t.prototype._initialize=function(e,t){this.game=e,this._initDebugging(t),this.makeMap(e)},t.prototype._initDebugging=function(t){var n;this.debugNamespace="platforms",this.debugging=e.debugging,n=this._initDebugMixin(t),!n},t.prototype.destroy=function(){},t.prototype.makeMap=function(e){var t,n,r;this.tiles.length||this._generateTiles(),r=(n=function(){var e,n,r,i;r=this.tiles,i=[];for(e=0,n=r.length;e<n;e++)t=r[e],i.push(t.join(","));return i}.call(this)).join("\n"),e.load.tilemap("platforms",null,r),this.tilemap=e.add.tilemap("platforms",this.tileWidth,this.tileHeight),this.tilemap.addTilesetImage(this.config.tileImageKey),this.tilemap.setCollisionBetween(1,16),this.layer=this.tilemap.createLayer(0),this.layer.resizeWorld()},t.prototype._createTileGeneratorState=function(){var e,t,n;return e=this.game.world.getBounds(),n={facing:"right",prevFacing:null,iCol:-1,iColStart:-1,iColEnd:-1,iRow:-1,iRowStart:-1,iRowEnd:0,iLedgeRow:-1,iLedgeLayer:-1,numCols:Math.floor(e.width/this.tileWidth),numRows:Math.floor(this.config.mapH/this.tileHeight),numRowsClearance:this.minLedgeSpacing.y+this.ledgeThickness,numLedgeRows:-1,rangeLedgeSize:this.maxLedgeSize-this.minLedgeSize,rangeRowSpacing:this.maxLedgeSpacing.y-this.minLedgeSpacing.y,rowSize:-1,rowSpacing:-1,rowTiles:null,rowType:null},t=(this.maxLedgeSpacing.y+this.minLedgeSpacing.y)/2+(this.ledgeThickness-1),n.numLedgeRows=Math.round(n.numRows/t),n},t.prototype._generateTiles=function(){var e;e=this._createTileGeneratorState(),this.tiles=[],e.iLedgeLayer=0,e.iLedgeRow=0,e.rowSpacing=this.minLedgeSpacing.y,e.iRow=e.iRowStart=e.numRows-1;while(!(e.iRow<e.iRowEnd))this._setupEachRow(e),e.iRow-e.numRowsClearance<=e.iRowEnd?(this._setupEmptyRow(e),e.iLedgeLayer>0?(e.iLedgeLayer--,_.last(this.ledges).rowIndex=e.iRowStart-e.iRow):e.rowTiles=[]):e.rowSpacing===0?(this._setupLedgeRow(e),e.iLedgeLayer=this.ledgeThickness-1):e.iLedgeLayer>0?e.iLedgeLayer--:(this._setupEmptyRow(e),e.rowSpacing--,e.iLedgeLayer=0),this._addRow(e),e.iRow--;this.tiles.reverse(),this.tiles=u(this.tiles),this.debug("tiles",this.tiles)},t.prototype._addLedgeDifficulty=function(e,t){var n;n=Math.pow(t.numLedgeRows/e.index,.3),e.spacing=Math.round(e.spacing/n),e.size=Math.round(e.size*n),e.spacing=Phaser.Math.clamp(e.spacing,this.minLedgeSpacing.y,this.maxLedgeSpacing.y),e.size=Phaser.Math.clamp(e.size,this.minLedgeSize,this.maxLedgeSize);switch(e.facing){case"left":e.end=e.size-1;break;case"right":e.start=e.end+1-e.size}},t.prototype._addRow=function(e){var t,n,i,s;e.rowType==="ledge"&&(i=new r,i.index=e.iLedgeRow,i.rowIndex=e.iRowStart-e.iRow,i.size=e.rowSize,i.spacing=e.rowSpacing,i.start=e.iColStart,i.end=e.iColEnd,i.facing=e.prevFacing,this._addLedgeDifficulty(i,e),this.ledges.push(i),e.iColStart=i.start,e.iColEnd=i.end);if(!e.rowTiles.length)for(n=t=0,s=e.numCols;0<=s?t<s:t>s;n=0<=s?++t:--t)(0<=n&&n<e.iColStart||e.iColEnd<n&&n<e.numCols||e.iColStart===e.iColEnd)&&e.rowTiles.push(o.Empty),e.iColStart<=n&&n<=e.iColEnd&&e.iColStart!==e.iColEnd&&e.rowTiles.push(o.Solid);this.tiles.push(e.rowTiles)},t.prototype._setupEmptyRow=function(e){e.iColStart=0,e.iColEnd=0,e.rowType="empty"},t.prototype._setupLedgeRow=function(e){e.iLedgeRow++,e.rowSize=this.minLedgeSize+parseInt(Math.random()*e.rangeLedgeSize),e.rowSpacing=this.minLedgeSpacing.y+parseInt(Math.random()*e.rangeRowSpacing),e.rowType="ledge",e.prevFacing=e.facing;switch(e.facing){case"left":e.iColStart=0,e.iColEnd=e.rowSize-1,e.facing="right";break;case"right":e.iColStart=e.numCols-e.rowSize,e.iColEnd=e.numCols-1,e.facing="left"}},t.prototype._setupEachRow=function(e){e.iLedgeLayer===0&&(e.rowTiles=[])},t}(),r=function(){function e(){this.index=-1,this.rowIndex=-1,this.size=-1,this.spacing=-1,this.start=-1,this.end=-1,this.facing="left";return}return e.prototype.createMidpoint=function(e){var t;return t=new s,t.x=this.size/2*e.tileWidth,this.facing==="right"&&(t.x=e.tilemap.widthInPixels-t.x),t.y=(e.tiles.length-1-this.rowIndex)*e.tileHeight,t},e}(),_.extend(i.prototype,n),_.extend(i,{Ledge:r,Tile:o})}),define("player",["defines","helpers"],function(e,t){"use strict";var n,r,i,s,o,u;return o=Phaser.Point,u=e.playerYOffset,n=t.AnimationMixin,r=t.DebugMixin,i={Left:-1,Right:1},s=function(){function t(e,t,n,r){this.config=e,this.cursors=n,this._initialize(t,r)}return t.Direction=i,t.LastFrame=52,t.prototype._initialize=function(e,t){var n,r,i;n=this.config.origin,r=n.x,i=n.y,this.sprite=e.add.sprite(r,i,"player",17),this.sprite.anchor=new o(.5,.5),this.animations=this.sprite.animations,this._initAnimations(),e.physics.arcade.enable(this.sprite),this.gravity=e.physics.arcade.gravity,this._initPhysics(),this._initState(),this._initDebugging(t)},t.prototype.destroy=function(){this.animations=null,this.physics=null,this.velocity=null,this.acceleration=null},t.prototype.distanceFallen=function(){return this._fallingPoint==null?0:this.sprite.y-this._fallingPoint.y},t.prototype.startEnding=function(e){var t;return this.control=!1,this.sprite.position.setTo(e.x-43,e.y),this.velocity.setTo(0),this.acceleration.setTo(0),this.physics.offset.setTo(0),this.physics.moves=!1,this._visualizeTurn(i.Right),t=this.playAnimation("end")},t.prototype.update=function(){if(this.control!==!0)return;this.nextAction="none",this.nextDirection=this._xDirectionInput(),this.velocity.clampY(-this.maxVelocity.y,this.maxVelocity.y),this.velocity.clampX(-this.maxVelocity.x,this.maxVelocity.x),this._canKeepRunning()&&(this.nextState="running"),this._canFall()&&(this.nextState="falling"),this._canLand()&&(this.nextState="landing"),this._canBeginTurn()&&this._beginTurn(),this._canEndTurn()&&this._endTurn(),this._canBeginRun()&&this._beginRun(),this._canEndRun()&&this._endRun(),this._canBeginJump()&&this._beginJump(),this._canEndJump()&&this._endJump(),this._isInMidAir()||(this.acceleration.x=0),this._canBuildRun()&&this._buildRun(),this._canBuildJump()&&this._buildJump(),this._changeAnimation(),this._changeState()},t.prototype._initAnimations=function(){this.animations.add("run",[0,1,2,3,4,5,6,7,8,9,10,11],30,!0),this.animations.add("stop",[12,13,14,15,16,17],24),this.animations.add("start",[17,16,15,14,13,12],24),this.animations.add("jump",[18,19,20,21,22,23,24,25,26,27,28,29,30,31],24),this.animations.add("land",[32,33,18,17],24),this.animations.add("end",[34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],12),this._nextActionOnComplete=null},t.prototype._initDebugging=function(t){var n,r,i,s,o;this.debugNamespace="player",this.debugging=e.debugging,n=this._initDebugMixin(t);if(!n)return;this.gui.addOpenFolder("drag").addRange(this.physics.drag,"x"),this.gui.addOpenFolder("maxVelocity").addRange(this.maxVelocity,"x").addRange(this.maxVelocity,"y"),o=["jumpAcceleration","jumpMaxDuration","jumpVelocityFactor","airFrictionRatio","runAcceleration"];for(r=0,i=o.length;r<i;r++)s=o[r],this.gui.addRange(this,s)},t.prototype._initPhysics=function(){var e,t,n,r;this.physics=this.sprite.body,t=this.physics,this.velocity=t.velocity,this.acceleration=t.acceleration,this.physics.collideWorldBounds=!0,this.physics.tilePadding=new o(0,this.sprite.height),this.physics.drag.x=1500,n=this.sprite,e=n.height,r=n.width,this._yOffset=u,this.physics.setSize(r/2,e/2,this._xOffset(),this._yOffset),this.jumpAcceleration=-4250,this.jumpMaxDuration=500,this.jumpVelocityFactor=.25,this.airFrictionRatio=.05,this.runAcceleration=300,this.maxVelocity=new o(200,800),this._jumpTimer=this.sprite.game.time.create()},t.prototype._initState=function(){this.animation=null,this.direction=i.Right,this.state="still",this.nextAction="none",this.nextDirection=null,this.nextState=null,this.control=!0,this._fallingPoint=null,this._keepCameraFocusUpdated=!0,this._turnDirection=null},t.prototype._changeAnimation=function(){var e,t,n,r;if(!this._isInMidAir()&&this.nextAction!=="none"){e=this.playAnimation(this.nextAction,(t=this.animation)!=null?t.loop:void 0),e&&this._nextActionOnComplete!=null&&(e.onComplete.addOnce(this._nextActionOnComplete,this),this._nextActionOnComplete=null);return}switch(this.nextState){case"running":this.playAnimation("run",!1);break;case"still":this.playAnimation(17,(n=this.animation)!=null?n.loop:void 0);break;case"falling":this.playAnimation(31,(r=this.animation)!=null?r.loop:void 0);break;case"landing":this.playAnimation("land")}},t.prototype._changeState=function(){var e;if(this.nextState===this.state)return;this.state==="rising"&&this.debug("jump:peak",this.physics.y),this.debug("state",this.nextState),this.nextState==="rising"&&this.debug("jump:start",this.physics.position),this.nextState==="falling"?this._fallingPoint==null&&(this._fallingPoint=(e=this.physics.position)!=null?e.clone():void 0):this.nextState==="still"&&this._fallingPoint!=null&&(this._fallingPoint=null),this.state=this.nextState},t.prototype._isAnimationInterruptible=function(){var e,t;return((e=this.animation)!=null?e.isFinished:void 0)||this.animation==null||((t=this.animation)!=null?t.loop:void 0)},t.prototype._isFullyFalling=function(){return this.state==="falling"&&this.velocity.y===this.maxVelocity.y},t.prototype._isFullyRunning=function(){var e;return this.state==="running"&&((e=this.animation)!=null?e.name:void 0)==="run"},t.prototype._isFullyStill=function(){return this.state==="still"&&this.animations.frame===17&&this.animation==null},t.prototype._isInMidAir=function(){var e;return(e=this.state)==="rising"||e==="falling"},t.prototype._isLanded=function(){var e;return((e=this.animation)!=null?e.name:void 0)==="land"&&this.animation.isFinished},t.prototype._xDirectionInput=function(){var e,t;if((e=this.cursors)!=null?e.left.isDown:void 0)return i.Left;if((t=this.cursors)!=null?t.right.isDown:void 0)return i.Right},t.prototype._xOffset=function(e){return e==null&&(e=this.direction),e*10},t.prototype._canBeginJump=function(){var e;return((e=this.cursors)!=null?e.up.isDown:void 0)&&(this._isFullyRunning()||this._isFullyStill())},t.prototype._canBuildJump=function(){var e;return this.nextAction!=="jump"&&((e=this.cursors)!=null?e.up.isDown:void 0)&&this._jumpTimer.running},t.prototype._canEndJump=function(){var e;return this.nextAction!=="jump"&&this._jumpTimer.running&&(((e=this.cursors)!=null?e.up.isUp:void 0)||this._jumpTimer.ms>=this.jumpMaxDuration)},t.prototype._canFall=function(){return this.velocity.y>0&&(this.state!=="rising"||!this._jumpTimer.running&&this.state==="rising")},t.prototype._canLand=function(){return this.state==="falling"&&this.physics.onFloor()},t.prototype._beginJump=function(){var e,t;this._jumpTimer.start(),this.nextAction="jump",this.nextState="rising",t=Math.abs(this.velocity.x/this.maxVelocity.x),e=1-this.jumpVelocityFactor+this.jumpVelocityFactor*t,this.acceleration.y=this.jumpAcceleration*e},t.prototype._buildJump=function(){var e;e=1e3-this.jumpMaxDuration+(this.jumpMaxDuration-this._jumpTimer.ms),e=Math.pow(e/1e3,2),this.acceleration.y*=e,this.debug("jump:build",e)},t.prototype._endJump=function(){this.debug("jump:end",this._jumpTimer.ms,{position:this.physics.position}),this.acceleration.y=this.gravity.y,this._jumpTimer.stop()},t.prototype._canBeginRun=function(){return this.nextDirection!=null&&this.nextDirection===this.direction&&!this._isInMidAir()&&(this._isFullyStill()||this._isLanded())},t.prototype._canBuildRun=function(){return this.nextDirection!=null},t.prototype._canEndRun=function(){return this.nextDirection==null&&!this._isInMidAir()},t.prototype._canKeepRunning=function(){return!this._canLand()&&!this._isInMidAir()},t.prototype._beginRun=function(){this.nextAction="start",this.nextState="running"},t.prototype._buildRun=function(){this.acceleration.x=this._isInMidAir()?this.runAcceleration*this.airFrictionRatio*-this.nextDirection:this.runAcceleration*this.nextDirection},t.prototype._endRun=function(){if(this.velocity.x!==0){this.nextAction="stop";return}this.nextState="still",this._turnDirection=null},t.prototype._canBeginTurn=function(){return this.nextDirection!=null&&this.nextDirection!==this.direction&&this.nextAction!=="start"&&this._turnDirection==null},t.prototype._canEndTurn=function(){return this.nextAction!=="stop"&&this._turnDirection!=null&&this._isAnimationInterruptible()},t.prototype._beginTurn=function(){this._isFullyStill()||(this.nextAction="stop"),this._turnDirection=this.nextDirection,this.debug("turn:start",this.velocity.x),this.debug("facing",this.nextDirection)},t.prototype._endTurn=function(){this._visualizeTurn(),this.nextAction="start",this.direction=this._turnDirection,this._turnDirection=null,this.debug("turn:end",this.velocity.x)},t.prototype._visualizeTurn=function(e){e==null&&(e=this._turnDirection),this.sprite.scale.x=e,this.physics.offset.set(this._xOffset(e),this._yOffset)},t}(),_.extend(s.prototype,n,r),s});var bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function r(){this.constructor=e}for(var n in t)hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("state-play",["background","defines","helpers","in-state-menu","platforms","player"],function(e,t,n,r,i,s){"use strict";var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;return u=Phaser.Camera,c=Phaser.Key,h=Phaser.Keyboard,d=Phaser.Physics,m=Phaser.Point,g=Phaser.Rectangle,y=Phaser.State,w=Phaser.Timer,x=t.domStateEvents,T=t.fontLarge,N=t.fontSmall,E=t.artH,C=t.mapH,S=t.deadzoneH,O=t.shakeFallH,k=t.playerH,L=t.playerW,A=t.playerYOffset,o=n.AnimationMixin,a=n.CameraMixin,b=n.TextMixin,l=n.DebugMixin,f=n.DebugDisplayMixin,p=14,v=function(n){function o(){return this.onFocus=bind(this.onFocus,this),this.onBlur=bind(this.onBlur,this),o.__super__.constructor.apply(this,arguments)}return extend(o,n),o.prototype.init=function(){var e;x&&(e=document.createEvent("CustomEvent"),e.initCustomEvent("state:play",!1,!1,void 0),this.game.parent.dispatchEvent(e)),this.debugging=t.debugging,this.developing=t.developing,this.detachedCamera=!1,this.ended=!1,this.debugDisplay=this.gui=null,this.cursors=null,this.background=this.mate=this.platforms=this.player=null,this.textLayout=null,_.extend(this.camera,a),this._fixCamera(),this.game.onBlur.add(this.onBlur),this.game.onFocus.add(this.onFocus),this._initDebugMixin,this._initDebugDisplayMixin(this.game)},o.prototype.create=function(){this.physics.startSystem(d.ARCADE),this.physics.arcade.gravity.y=500,this.cursors=this.input.keyboard.createCursorKeys(),this.quitKey=this._addKey(h.Q,this.quit),this.input.onTap.add(function(e){return function(t){e.quit(t)||e.inStateMenu.toggle()}}(this),this),this.developing&&(this.gui=new dat.GUI,this.gui.add(this,"debugging").listen().onFinishChange(function(e){return function(){e.background.debugging=e.platforms.debugging=e.player.debugging=e.debugging,e.debugging||e.debugDisplay.reset()}}(this)),this.gui.add(this,"detachedCamera").onFinishChange(function(e){return function(){e._toggleCameraAttachment()}}(this)),this.gui.addOpenFolder("gravity").addRange(this.physics.arcade.gravity,"y")),this._addMusic(),this._addBackground(),this._addPlatforms(),this._addPlayer(),this._addMate(),this._addInStateMenu(),this.camera.deadzone=new g(0,(this.game.height-S)/2,this.game.width,S),this._toggleCameraAttachment(!0),_.defer(function(e){return function(){e.camera.lerp.set(.05)}}(this))},o.prototype.update=function(){this.physics.arcade.collide(this.player.sprite,this.platforms.layer),this.background.update(),this.player.update(),this._updateVolumeOnPlayerLand(),this._shakeOnPlayerFall(),this.detachedCamera&&this.camera.updatePositionWithCursors(this.cursors),this._isPlayerReadyToEnd()&&this.end()},o.prototype.render=function(){this.debugging&&this._renderDebugDisplay(),this.debugging&&this._renderDebugOverlays()},o.prototype.shutdown=function(){var e,t,n,r,i,s,o,u,a;o=[this.background,this.inStateMenu,this.music,this.platforms,this.player];for(t=0,i=o.length;t<i;t++)e=o[t],e.destroy();this.game.onBlur.remove(this.onBlur),this.game.onFocus.remove(this.onFocus),this.input.onTap.removeAll(this),u=[this.loudKey,this.muteKey,this.quietKey,this.quitKey];for(n=0,s=u.length;n<s;n++)r=u[n],r.onDown.removeAll(this);(a=this.gui)!=null&&a.destroy()},o.prototype.onBlur=function(){var e;(e=this.music)!=null&&e.pause()},o.prototype.onFocus=function(){var e;(e=this.music)!=null&&e.resume()},o.prototype.end=function(){var e;e=this.player.startEnding(this.mate),e.onComplete.addOnce(function(t){return function(){return e=t.mate.play("end"),e.onComplete.addOnce(function(){return t.player.animations.frame=s.LastFrame,t.mate.animations.frame=p})}}(this)),_.delay(function(e){return function(){e._renderEndingDisplay()}}(this),5*w.SECOND)},o.prototype.quit=function(e){var t;return this.ended||e instanceof c?(this.inStateMenu.toggle(!1),t=function(e){return function(){e.state.startWithTransition(null,"menu",!0)}}(this),this.music.volume===0?t():(this.music.fadeOut(3*w.SECOND),this.music.onFadeComplete.addOnce(t)),!0):!1},o.prototype._addBackground=function(){var t;t=C-E,this.background=new e({parallaxTolerance:t},this.game),this.background.addImages(_.template("bg<%= zIndex %>"),16),this.background.layout()},o.prototype._addInStateMenu=function(){this.inStateMenu=new r([["Paused",{fontSize:T}],["Hold arrow keys to accelerate",{fontSize:N}],["Press 0, -, + for volume",{fontSize:N}],["Press Q to quit",{fontSize:N}]],this.game,{pauseHandler:function(e){return function(t){e.player.control=!t}}(this)})},o.prototype._addKey=function(e,t){var n;return n=this.input.keyboard.addKey(e),n.onDown.add(t,this),this.input.keyboard.removeKeyCapture(e),n},o.prototype._addMate=function(){var e,t,n,r,i;t=this.endingPoint,r=t.x,i=t.y,r+=20,i-=10,this.mate=this.add.sprite(r,i,"mate",1),this.mate.anchor=new m(.5,.5),this.mate.animations.add("end",function(){n=[];for(var e=4;4<=p?e<=p:e>=p;4<=p?e++:e--)n.push(e);return n}.apply(this),12)},o.prototype._addMusic=function(){var e,t;this.userVolume=1,this.music=this.add.audio("bgm",.2,!0),this.music.mute=this.developing||this.debugging,this.music.play(),(t=this.gui)!=null&&t.add(this.music,"mute").listen(),e=.1,this.loudKey=this._addKey(h.EQUALS,function(t){return function(){t.userVolume+=e}}(this)),this.muteKey=this._addKey(h.ZERO,function(e){return function(){e.music.mute=!e.music.mute}}(this)),this.quietKey=this._addKey(h.UNDERSCORE,function(t){return function(){t.userVolume-=e}}(this))},o.prototype._addPlatforms=function(){var e;this.platforms=new i({mapH:C,tileImageKey:"balcony"},this.game,(e=this.gui)!=null?e.addOpenFolder("platforms"):void 0),this.endingPoint=this.platforms.ledges.slice(-1)[0].createMidpoint(this.platforms),this.startingPoint=new m(L,this.world.height-k+A)},o.prototype._addPlayer=function(){var e,t;e=this.startingPoint,this.player=new s({origin:e},this.game,this.cursors,(t=this.gui)!=null?t.addOpenFolder("player"):void 0)},o.prototype._addText=function(e,t){var n;return _.defaults(t,{fill:"#fff",font:"Enriqueta"}),e=this.addCenteredText(e,this.textLayout,t),n=this.fadeTo(e,w.SECOND,1)},o.prototype._fixCamera=_.once(function(){this.camera.flawedUpdateTarget=this.camera.updateTarget,this.camera.updateTarget=function(e){return function(){e.camera.target.world.copyFrom(e.camera.target.position),e.camera.flawedUpdateTarget()}}(this)}),o.prototype._isPlayerReadyToEnd=function(){return this.player.state==="still"&&this.player.control===!0&&this.player.sprite.y<=this.endingPoint.y},o.prototype._renderDebugDisplay=function(){this.resetDebugDisplayLayout();if(this.player.debugging)return this.renderDebugDisplayItems(function(e){return function(t,n){e.debugDisplay.bodyInfo(e.player.sprite,t,n)}}(this),6),this.renderDebugDisplayItems(this.player.debugTextItems)},o.prototype._renderDebugOverlays=function(){this.player.debugging&&(this.debugDisplay.body(this.player.sprite),this.debugDisplay.spriteBounds(this.player.sprite))},o.prototype._renderEndingDisplay=function(){this.textLayout={y:120,baseline:40},this._addText("The End",{fontSize:T}).onComplete.addOnce(function(e){return function(){e._addText("Click to play again",{fontSize:N}),e.ended=!0}}(this))},o.prototype._shakeOnPlayerFall=function(){var e;if(!(this.player.nextState==="landing"&&this.player.distanceFallen()>O))return!1;e=!1,this.camera.shake(.02,.1*w.SECOND,e,u.SHAKE_VERTICAL)},o.prototype._toggleCameraAttachment=function(e){var t;e==null&&(e=!this.detachedCamera),e?(this.camera.follow(this.player.sprite),(t=this.player).cursors==null&&(t.cursors=this.cursors)):(this.camera.unfollow(),this.player.cursors=null)},o.prototype._updateVolumeOnPlayerLand=function(){var e;if(this.player.nextState!=="landing")return!1;e=Math.pow((this.platforms.tilemap.heightInPixels-this.player.sprite.y)/this.platforms.tilemap.heightInPixels,1.3),e*=this.math.clamp(this.userVolume,0,2),e=this.math.clamp(e,.2,.8),this.music.fadeTo(w.SECOND,e)},o}(y),_.extend(v.prototype,o,l,f,b),v}),requirejs.config({baseUrl:"./release"}),define("game",["defines","helpers","site","state-boot","state-menu","state-preload","state-play"],function(e,t,n,r,i,s,o){"use strict";var u,a,f,l,c,h,p;u=Phaser.Point,l=e.debugging,h=e.gameH,p=e.gameW,a=t.PointMixin,f=t.StateManagerMixin,_.extend(u.prototype,a),c=new Phaser.Game(p,h,Phaser.AUTO,document.getElementById("morning-stroll")),_.extend(c.state,f),c.state.add("boot",r),c.state.add("preload",s),c.state.add("menu",i),c.state.add("play",o),c.state.start("boot"),document.body.className="ready",n.initFiddle(c),n.initAbout();if(l===!0)return window.game=c}),require(["game"]);